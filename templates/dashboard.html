{% extends "base.html" %}
{% block content %}
<div class="px-10 pb-10">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-yellow-400">Zen-Zone Dashboard</h1>
      <p class="text-gray-400">Welcome back, {{ display_name }}.</p>
    </div>
    <div class="flex items-center gap-3">
      <span class="px-3 py-1 text-sm rounded-full bg-gray-200 dark:bg-gray-800">
        Members: {{ members }}/{{ member_goal }}
      </span>
      <button class="px-4 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-sm font-semibold">
        Logout
      </button>
    </div>
  </div>

  <!-- Stats row -->
  <div class="grid grid-cols-4 gap-6 mb-6">
    <div class="p-4 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <p class="text-sm text-gray-400">Founder</p>
      <p class="text-xl font-bold">{{ founder }}</p>
      <p class="mt-2 text-xs text-green-400">Owner of Zen-Zone</p>
    </div>

    <div class="p-4 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <p class="text-sm text-gray-400">Co-Founder</p>
      <p class="text-xl font-bold">{{ cofounder }}</p>
      <p class="mt-2 text-xs text-blue-400">Second in command</p>
    </div>

    <div class="p-4 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <p class="text-sm text-gray-400">Members</p>
      <p class="text-3xl font-bold">{{ members }}</p>
      <p class="mt-2 text-xs text-gray-400">Goal: {{ member_goal }} members</p>
    </div>

    <div class="p-4 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <p class="text-sm text-gray-400">Bots</p>
      <p class="text-3xl font-bold">{{ bots }}</p>
      <p class="mt-2 text-xs text-purple-400">Discord helpers</p>
    </div>
  </div>

  <!-- Middle section -->
  <div class="grid grid-cols-3 gap-6 mb-6">

    <!-- Circle Progress -->
    <div class="p-6 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700 flex flex-col items-center">
      <h2 class="text-lg font-semibold mb-4 text-yellow-400">Member Goal Progress</h2>
      <div class="progress-ring" style="--percent: {{ member_percent }}">
        <div class="progress-ring-inner">
          <div class="text-center">
            <div class="text-2xl font-bold">{{ member_percent }}%</div>
            <div class="text-xs text-gray-400">{{ members }}/{{ member_goal }}</div>
          </div>
        </div>
      </div>
      <p class="mt-3 text-xs text-gray-400">{{ member_goal - members }} more needed.</p>
    </div>

    <!-- WORLD MAP -->
    <div class="p-6 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <h2 class="text-lg font-semibold mb-4 text-yellow-400">Active Location</h2>

      <p class="text-xs text-gray-400 mb-2">User accessing from:
        <span id="country-label" class="text-yellow-400">Detecting...</span>
      </p>

      <div id="world-map" class="world-map">
        <div id="map-pin" class="map-pin"></div>
      </div>

      <p class="mt-2 text-[10px] text-gray-500">Location is approximate.</p>
    </div>

    <!-- Access Logs -->
    <div class="p-6 rounded-2xl bg-gray-200 dark:bg-[#1f1f1f] shadow border dark:border-gray-700">
      <h2 class="text-lg font-semibold mb-4 text-yellow-400">Access Logs</h2>
      <ul class="space-y-1 text-sm">
        {% for person in access_logs %}
        <li class="flex justify-between bg-gray-100 dark:bg-[#252525] px-3 py-1.5 rounded-xl">
          <span>{{ person }}</span>
          <span class="text-[10px] text-gray-400">Zen-Zone Panel</span>
        </li>
        {% endfor %}
      </ul>
    </div>

  </div>

</div>

<!-- LOCATION SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  const pin = document.getElementById("map-pin");
  const label = document.getElementById("country-label");

  fetch("https://ipapi.co/json/")
    .then(res => res.json())
    .then(data => {
      label.textContent = data.country_name + " (" + data.city + ")";

      let lat = data.latitude;
      let lon = data.longitude;

      // Convert to %
      const top = 100 - ((lat + 90) / 180 * 100);
      const left = ((lon + 180) / 360 * 100);

      pin.style.top = top + "%";
      pin.style.left = left + "%";
    })
    .catch(() => {
      label.textContent = "Unknown";
    });

});
</script>

{% endblock %}
